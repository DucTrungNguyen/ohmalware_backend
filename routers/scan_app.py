from fastapi import APIRouter, File, UploadFile
from ultils.helper import *
from modules.reverse.reverse import reverse
from modules.detect import Train

router = APIRouter()


@router.put("/scan_featured/", tags="scan_featured")
async def scan_app_with_featured():
    a = 1


@router.put("/scan_singlefile/", tags="scan_singlefile")
async def scan_single_app(file: UploadFile = File(...)):
    try:

        file_name = file.filename
        if check_extension(file_name=file_name):
            a = 1
            name_md5, apk_total_analysis = reverse(file_name)

            if name_md5 == 'Error':
                predict_json = {"name_label": 'Null'}
            else:
                predict_json = Train.detectApk(name_md5)


            return {'status': 200}
        else:
            return {'status': 400}

    except Exception as e:
        return {'status': 500}


@router.put("/scan_multi", tags="scan_multi")
async def scan_multi():
    try:
        a = 1
        return {'status': 200}
    except Exception as e:
        return {'status': 500}
